<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rock Paper Scissor</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header"> Rock Paper Scissor </div>

    <div class="playerRow">
        <div class="user">
            <img src="images/userPic.jpg" alt="User Profile Pic" height="200">
            <div class="score">
                <div>You:</div>
                <div id="userScore">0</div>
            </div>
            
        </div>
        
        <img class="playerButton rock" src="images/rockBlue.png" alt="User Rock" height="200" style="margin-left: 100px">
        <img class="playerButton paper" src="images/paperBlue.png" alt="User Paper" height="200">
        <img class="playerButton scissor" src="images/scissorBlue.png" alt="User Scissor" height="200">
    </div>

    <div class="computerRow">
        <div class="computer">
            <img src="images/computerPic.jpg" alt="Computer Profile Pic" height="200">
            <div class="score">
                <div> HAL9000:</div>
                <div id="computerScore">0</div>
            </div>
            
        </div>
        
        <img id="computerChoiceImg" src="images/computerThinking.png" alt="Computer Thinking" height="200" style="margin-left: 50px">

        <div class="results">
            <div id="winner">Make your selection!</div>
            <div id="windesc">HAL9000 is plotting...</div>
        </div>

    </div>

    <div class="footer">Copyright Sebastian Hothaza</div>


    <script>
        // Note, these have global scope
        let computerScore = 0;
        let playerScore = 0;
        let numTies = 0;
        const numRounds = 3;


        const playerButtons = document.querySelectorAll('.playerButton'); // Selecting all buttons so we can attach listeners

        // Attaching the listeners to each button
        playerButtons.forEach((playerButton) => {
            playerButton.addEventListener('click', (e) => {
                getPlayerChoice(e.target);
            });
        });

        // Sent a click event target object, plays a round
        function getPlayerChoice(e){

            // Defining the player choice
            let playerChoice;
            if(e.className.includes("rock")){
                playerChoice = "rock";
            } else if (e.className.includes("paper")){
                playerChoice = "paper";
            } else if (e.className.includes("scissor")){
                playerChoice = "scissor";
            }
            const computerChoice = getComputerChoice();
            console.log("Player chose: " + playerChoice);
            console.log("Computer chose: " + computerChoice);

            

            // Update image of computer thinking to reflect their decision
            if (computerChoice==="rock"){
                document.getElementById('computerChoiceImg').src = "images/rockRed.png";
            } else if (computerChoice==="paper"){
                document.getElementById('computerChoiceImg').src = "images/paperRed.png";
            } else {
                document.getElementById('computerChoiceImg').src = "images/scissorRed.png";
            }

            // Selections complete; now we play!
            let winner = playRound(playerChoice, computerChoice);
            console.log(winner + "wins");
            
            // Scoring
            if (winner == "Player"){
                playerScore++;
                document.getElementById("userScore").innerHTML++;

                document.getElementById("winner").textContent = "You Win!";
                document.getElementById("windesc").textContent = playerChoice + " beats " + computerChoice;
            } else if (winner == "Computer"){
                computerScore++;
                document.getElementById("computerScore").innerHTML++;

                document.getElementById("winner").textContent = "You Lose!";
                document.getElementById("windesc").textContent =  computerChoice + " beats " + playerChoice;
            } else {
                numTies++;
                document.getElementById("winner").textContent = "Tie Game!";
                document.getElementById("windesc").textContent =  "HAL is not amused...";
            }
            console.log("userscore: "+playerScore);
            console.log("computerScore: "+computerScore);

            // Time before next round
            window.setTimeout(resetBoard, 2000);

            // Ending the game. Calls endGame with winner
            if (playerScore+computerScore == 5){
                if (playerScore>computerScore){
                    endGame("player"); 
                } else {
                    setTimeout(endGame("computer"), 1000);  
                }
            }
        }




        // Resets board
        function resetBoard(){
            // TODO: CSS toggle for hand
            document.getElementById('computerChoiceImg').src = "images/computerThinking.png";
            document.getElementById("winner").textContent = "Make your selection!";
            document.getElementById("windesc").textContent =  "HAL9000 is plotting...";

        }

        // Ends the game and prepares for new game
        function endGame(winner){
            playerScore=0;
            computerScore=0;


            if (winner === "player"){
                setTimeout(function () {
                    alert("You Win! Hope you are proud of your accomplishment.");
                    document.getElementById("computerScore").innerHTML=0;
                    document.getElementById("userScore").innerHTML=0;
                 }, 100);
            } else {
                setTimeout(function () {
                    alert("You Lose! HAL has taken control of your life.");
                    document.getElementById("computerScore").innerHTML=0;
                    document.getElementById("userScore").innerHTML=0;
                }, 100);
            }
            
            
        }
        
        // returns oneof(rock, paper scissor)
        function getComputerChoice(){
            let num = Math.floor(Math.random() * 3 + 1);
            switch (num){
                case 1:
                    return "rock";
                case 2:
                    return "paper";
                case 3:
                    return "scissor";
            }
        }


        // Plays a round and returns a string of the resulting winner (OneOf: Player, Computer or Tie)
        function playRound(playerSelection, computerSelection){
            if (playerSelection.toUpperCase() === "ROCK"){
                if (computerSelection.toUpperCase() === "ROCK"){
                    return "Tie"
                } else if (computerSelection.toUpperCase() === "PAPER"){
                    return "Computer"
                } else {
                    return "Player"
                }
            } else if (playerSelection.toUpperCase() === "PAPER"){
                if (computerSelection.toUpperCase() === "ROCK"){
                    return "Player"
                } else if (computerSelection.toUpperCase() === "PAPER"){
                    return "Tie"
                } else {
                    return "Computer"
                }
            } else{
                if (computerSelection.toUpperCase() === "ROCK"){
                    return "Computer"
                } else if (computerSelection.toUpperCase() === "PAPER"){
                    return "Player"
                } else {
                    return  "Tie"
                }
            }
        }
    
        </script>
    
</body>
</html>